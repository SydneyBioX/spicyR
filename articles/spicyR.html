<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatial Mixed-Effects Modelling with spicy â€¢ spicyR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Mixed-Effects Modelling with spicy">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spicyR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/spicyR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SydneyBioX/spicyR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatial Mixed-Effects Modelling with spicy</h1>
                        <h4 data-toc-skip class="author">Nicolas
Canete</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
Australia<br><a class="author_email" href="mailto:#"></a><a href="mailto:nicolas.canete@sydney.edu.au" class="email">nicolas.canete@sydney.edu.au</a>
      </address>
                              <h4 data-toc-skip class="author">Ellis
Patrick</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
AustraliaSchool of Mathematics and Statistics, University of Sydney,
Australia<br><h4 data-toc-skip class="author">Alex
Qin</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
AustraliaSchool of Mathematics and Statistics, University of Sydney,
Australia<br><h4 data-toc-skip class="date">31 July 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SydneyBioX/spicyR/blob/devel/vignettes/spicyR.Rmd" class="external-link"><code>vignettes/spicyR.Rmd</code></a></small>
      <div class="d-none name"><code>spicyR.Rmd</code></div>
    </address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"spicyR"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellispatrick.github.io/spicyR/" class="external-link">spicyR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drighelli/SpatialExperiment" class="external-link">SpatialExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BodenmillerGroup/imcRtools" class="external-link">imcRtools</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This guide will provide a step-by-step guide on how mixed effects
models can be applied to multiple segmented and labelled images to
identify how the localisation of different cell types can change across
different conditions. Here, the subject is modelled as a random effect,
and the different conditions are modelled as a fixed effect.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>Here, we use a subset of the Damond et al., 2019 imaging mass
cytometry dataset. We will compare the spatial distributions of cells in
the pancreatic islets of individuals with early onset diabetes and
healthy controls.</p>
<p><code>diabetesData</code> is a <code>SingleCellExperiment</code>
object containing single-cell data of 160 images from 8 subjects, with
20 images per subject.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"diabetesData"</span><span class="op">)</span></span>
<span><span class="va">diabetesData</span></span>
<span><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span><span class="co">#&gt; dim: 0 253777 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(0):</span></span>
<span><span class="co">#&gt; rownames: NULL</span></span>
<span><span class="co">#&gt; rowData names(0):</span></span>
<span><span class="co">#&gt; colnames: NULL</span></span>
<span><span class="co">#&gt; colData names(11): imageID cellID ... group stage</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span></code></pre></div>
<p>In this data set, cell types include immune cell types (B cells,
naive T cells, T Helper cells, T cytotoxic cells, neutrophils,
macrophages) and pancreatic islet cells (alpha, beta, gamma, delta).</p>
</div>
<div class="section level2">
<h2 id="mixed-effects-modelling">Mixed Effects Modelling<a class="anchor" aria-label="anchor" href="#mixed-effects-modelling"></a>
</h2>
<p>To investigate changes in localisation between two different cell
types, we measure the level of localisation between two cell types by
modelling with the L-function. Specifically, the mean difference between
the obtained function and the theoretical function is used as a measure
for the level of localisation. Differences of this statistic between two
conditions is modelled using a weighted mixed effects model, with
condition as the fixed effect and subject as the random effect.</p>
<div class="section level3">
<h3 id="testing-for-change-in-localisation-for-a-specific-pair-of-cells">Testing for change in localisation for a specific pair of cells<a class="anchor" aria-label="anchor" href="#testing-for-change-in-localisation-for-a-specific-pair-of-cells"></a>
</h3>
<p>Firstly, we can test whether one cell type tends to be more localised
with another cell type in one condition compared to the other. This can
be done using the <code><a href="../reference/spicy.html">spicy()</a></code> function, where we include
<code>condition</code>, and <code>subject</code>.</p>
<p>In this example, we want to see whether or not Delta cells
(<code>to</code>) tend to be found around Beta cells (<code>from</code>)
in onset diabetes images compared to non-diabetic images. However, given
that there are 3 conditions, we can specify the desired conditions by
setting the order of our <code>condition</code> factor.
<code><a href="../reference/spicy.html">spicy()</a></code> will choose the first level of the factor as the
base condition and the second level as the comparison condition.
<code><a href="../reference/spicy.html">spicy()</a></code> will also naturally coerce the
<code>condition</code> column into a factor if not already a factor.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spicyTestPair</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spicy.html">spicy</a></span><span class="op">(</span></span>
<span>  <span class="va">diabetesData</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"stage"</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"case"</span>,</span>
<span>  from <span class="op">=</span> <span class="st">"beta"</span>,</span>
<span>  to <span class="op">=</span> <span class="st">"delta"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/topPairs.html">topPairs</a></span><span class="op">(</span><span class="va">spicyTestPair</span><span class="op">)</span></span>
<span><span class="co">#&gt;             intercept coefficient     p.value  adj.pvalue from    to</span></span>
<span><span class="co">#&gt; beta__delta  182.2128   -34.00085 0.008724782 0.008724782 beta delta</span></span></code></pre></div>
<p>We obtain a <code>spicy</code> object which details the results of
the mixed effects modelling performed. As the <code>coefficient</code>
in <code>spicyTest</code> is positive, we find that delta cells cells
are significantly less likely to be found near beta cells in the onset
diabetes group compared to the non-diabetic control.</p>
</div>
<div class="section level3">
<h3 id="test-for-change-in-localisation-for-all-pairwise-cell-combinations">Test for change in localisation for all pairwise cell
combinations<a class="anchor" aria-label="anchor" href="#test-for-change-in-localisation-for-all-pairwise-cell-combinations"></a>
</h3>
<p>Here, we can perform what we did above for all pairwise combinations
of cell types by excluding the <code>from</code> and <code>to</code>
parameters from <code><a href="../reference/spicy.html">spicy()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spicyTest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spicy.html">spicy</a></span><span class="op">(</span></span>
<span>  <span class="va">diabetesData</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"stage"</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"case"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/topPairs.html">topPairs</a></span><span class="op">(</span><span class="va">spicyTest</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          intercept coefficient      p.value adj.pvalue</span></span>
<span><span class="co">#&gt; beta__delta           1.815457e+02  -48.736479 0.0005032491 0.07169646</span></span>
<span><span class="co">#&gt; delta__beta           1.817943e+02  -48.166076 0.0005601286 0.07169646</span></span>
<span><span class="co">#&gt; B__unknown           -1.442506e-15   11.770769 0.0052340673 0.42052603</span></span>
<span><span class="co">#&gt; delta__delta          2.089550e+02  -52.061196 0.0125129204 0.42052603</span></span>
<span><span class="co">#&gt; unknown__macrophage   1.007336e+01  -15.826911 0.0207411810 0.42052603</span></span>
<span><span class="co">#&gt; unknown__B           -2.212263e-15   12.142843 0.0225856400 0.42052603</span></span>
<span><span class="co">#&gt; macrophage__unknown   1.004422e+01  -14.471640 0.0244668217 0.42052603</span></span>
<span><span class="co">#&gt; B__Th                 4.714404e-15   26.847613 0.0245045799 0.42052603</span></span>
<span><span class="co">#&gt; otherimmune__naiveTc -9.292507e+00   33.584768 0.0255811877 0.42052603</span></span>
<span><span class="co">#&gt; ductal__ductal        1.481580e+01   -8.632552 0.0266937176 0.42052603</span></span>
<span><span class="co">#&gt;                             from         to</span></span>
<span><span class="co">#&gt; beta__delta                 beta      delta</span></span>
<span><span class="co">#&gt; delta__beta                delta       beta</span></span>
<span><span class="co">#&gt; B__unknown                     B    unknown</span></span>
<span><span class="co">#&gt; delta__delta               delta      delta</span></span>
<span><span class="co">#&gt; unknown__macrophage      unknown macrophage</span></span>
<span><span class="co">#&gt; unknown__B               unknown          B</span></span>
<span><span class="co">#&gt; macrophage__unknown   macrophage    unknown</span></span>
<span><span class="co">#&gt; B__Th                          B         Th</span></span>
<span><span class="co">#&gt; otherimmune__naiveTc otherimmune    naiveTc</span></span>
<span><span class="co">#&gt; ductal__ductal            ductal     ductal</span></span></code></pre></div>
<p>We can also examine the L-function metrics of individual images by
using the convenient <code><a href="../reference/bind.html">bind()</a></code> function on our spicyTest
results object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bind.html">bind</a></span><span class="op">(</span><span class="va">spicyTest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;   imageID condition subject ductal__ductal stromal__ductal</span></span>
<span><span class="co">#&gt; 1     A09     Onset    6362      3.5882456        2.221666</span></span>
<span><span class="co">#&gt; 2     A11     Onset    6362      3.5803460       -5.070033</span></span>
<span><span class="co">#&gt; 3     A16     Onset    6362     29.8249524        7.859502</span></span>
<span><span class="co">#&gt; 4     A17     Onset    6362     30.8885146       20.136107</span></span>
<span><span class="co">#&gt; 5     A25     Onset    6362      0.9820586       -3.173230</span></span></code></pre></div>
<p>Again, we obtain a <code>spicy</code> object which outlines the
result of the mixed effects models performed for each pairwise
combination of cell types.</p>
<p>We can represent this as a bubble plot using the
<code><a href="../reference/signifPlot.html">signifPlot()</a></code> function by providing it the
<code>spicy</code> object obtained. Here, we can observe that the most
significant relationships occur between pancreatic beta and delta cells,
suggesting that the 2 cell types are far more localised during diabetes
onset compared to non-diabetics.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/signifPlot.html">signifPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">spicyTest</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  marksToPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>,</span>
<span>    <span class="st">"B"</span>, <span class="st">"naiveTc"</span>, <span class="st">"Th"</span>, <span class="st">"Tc"</span>, <span class="st">"neutrophil"</span>, <span class="st">"macrophage"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="spicyR_files/figure-html/unnamed-chunk-8-1.png" width="700">
If weâ€™re interested and wish to examine a specific cell type-cell type
relationship in more detail, we can use <code>spicyBoxPlot</code>,
specifying the relationship we want to examine.</p>
<p>In the bubble plot above, we can see that the most significant
relationship is between beta and delta islet cells in the pancreas. To
examine this further, we can specify either <code>from = beta</code> and
<code>to = delta</code> or <code>rank = 1</code> parameters in
<code>spicyBoxPlot</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spicyBoxPlot.html">spicyBoxPlot</a></span><span class="op">(</span>results <span class="op">=</span> <span class="va">spicyTest</span>,</span>
<span>             <span class="co"># from = "beta",</span></span>
<span>             <span class="co"># to = "delta",</span></span>
<span>             rank <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="spicyR_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="mixed-effects-modelling-for-custom-metrics">Mixed effects modelling for custom metrics<a class="anchor" aria-label="anchor" href="#mixed-effects-modelling-for-custom-metrics"></a>
</h3>
<p><code>spicyR</code> can also be applied to custom distance or
abundance metrics. Here, we provide an example where we apply the
<code>spicy</code> function to a custom abundance metric.</p>
<p>We first obtain the custom abundance metric by converting the a
<code>SpatialExperiment</code> object from the existing
<code>SingleCellExperiment</code> object. A KNN interactions graph is
then generated with the function <code>buildSpatialGraph</code> from the
<code>imcRtools</code> package. This generates a <code>colPairs</code>
object inside of the SpatialExperiment object. <code>spicyR</code>
provides the function <code>convPairs</code> for converting a
<code>colPairs</code> object stored within a
<code>SingleCellExperiment</code> object into an abundance matrix by
effectively calculating the average number of nearby cells types for
every cell type. For example, if there exists on average 5 neutrophils
for every macrophage in image 1, the column
<code>neutrophil__macrophage</code> would have a value of 5 for image
1.</p>
<p><code>spicy</code> can take any input of pairwise cell type
combinations across multiple images and run a mixed effects model to
determine collective differences across conditions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diabetesData_SPE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment.html" class="external-link">SpatialExperiment</a></span><span class="op">(</span><span class="va">diabetesData</span>,</span>
<span>                                      colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">diabetesData</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoordsNames</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diabetesData_SPE</span> <span class="op">&lt;-</span> <span class="fu">imcRtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/imcRtools/man/buildSpatialGraph.html" class="external-link">buildSpatialGraph</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span>, img_id <span class="op">=</span> <span class="st">"imageID"</span>, type <span class="op">=</span> <span class="st">"knn"</span>, k <span class="op">=</span> <span class="fl">20</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'sample_id's are duplicated across 'SpatialExperiment' objects to cbind; appending sample indices.</span></span>
<span><span class="co">#&gt; The returned object is ordered by the 'imageID' entry.</span></span>
<span></span>
<span><span class="va">pairAbundances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convPairs.html">convPairs</a></span><span class="op">(</span><span class="va">diabetesData_SPE</span>,</span>
<span>                  colPair <span class="op">=</span> <span class="st">"knn_interaction_graph"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pairAbundances</span><span class="op">[</span><span class="st">"delta__delta"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     delta__delta</span></span>
<span><span class="co">#&gt; A09     2.590909</span></span>
<span><span class="co">#&gt; A11     4.816901</span></span>
<span><span class="co">#&gt; A16     1.769231</span></span>
<span><span class="co">#&gt; A17     0.500000</span></span>
<span><span class="co">#&gt; A25     0.000000</span></span>
<span><span class="co">#&gt; A39     1.354839</span></span></code></pre></div>
<p><code>spicy</code> can take any input of pairwise cell type
combinations across multiple images and run a mixed effects model to
determine collective differences across conditions. To check out other
custom distance metrics which can be used, feel free to check out the
<code>Statial</code> package.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spicyTestColPairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spicy.html">spicy</a></span><span class="op">(</span></span>
<span>  <span class="va">diabetesData_SPE</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"stage"</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"case"</span>,</span>
<span>  alternateResult <span class="op">=</span> <span class="va">pairAbundances</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/topPairs.html">topPairs</a></span><span class="op">(</span><span class="va">spicyTestColPairs</span><span class="op">)</span></span>
<span><span class="co">#&gt;                           intercept coefficient     p.value adj.pvalue</span></span>
<span><span class="co">#&gt; otherimmune__acinar    8.014651e+00 -3.94111077 0.001992740  0.1479393</span></span>
<span><span class="co">#&gt; macrophage__macrophage 1.524442e-03  0.01186938 0.003008538  0.1479393</span></span>
<span><span class="co">#&gt; acinar__delta          3.040471e-17  0.19829545 0.004003918  0.1479393</span></span>
<span><span class="co">#&gt; gamma__endothelial     3.206950e-01  0.63169966 0.004155627  0.1479393</span></span>
<span><span class="co">#&gt; ductal__stromal        6.534490e+00 -2.57742854 0.004447591  0.1479393</span></span>
<span><span class="co">#&gt; ductal__otherimmune    1.200000e+00  5.09868056 0.004738815  0.1479393</span></span>
<span><span class="co">#&gt; Th__otherimmune        1.982832e-01  0.61070185 0.005878459  0.1479393</span></span>
<span><span class="co">#&gt; unknown__alpha         3.560011e-01  0.65020515 0.006006260  0.1479393</span></span>
<span><span class="co">#&gt; Th__stromal            9.233434e+00 -3.42016198 0.006338838  0.1479393</span></span>
<span><span class="co">#&gt; endothelial__ductal    8.673736e-04  0.01574398 0.006775857  0.1479393</span></span>
<span><span class="co">#&gt;                               from          to</span></span>
<span><span class="co">#&gt; otherimmune__acinar    otherimmune      acinar</span></span>
<span><span class="co">#&gt; macrophage__macrophage  macrophage  macrophage</span></span>
<span><span class="co">#&gt; acinar__delta               acinar       delta</span></span>
<span><span class="co">#&gt; gamma__endothelial           gamma endothelial</span></span>
<span><span class="co">#&gt; ductal__stromal             ductal     stromal</span></span>
<span><span class="co">#&gt; ductal__otherimmune         ductal otherimmune</span></span>
<span><span class="co">#&gt; Th__otherimmune                 Th otherimmune</span></span>
<span><span class="co">#&gt; unknown__alpha             unknown       alpha</span></span>
<span><span class="co">#&gt; Th__stromal                     Th     stromal</span></span>
<span><span class="co">#&gt; endothelial__ductal    endothelial      ductal</span></span></code></pre></div>
<p>Again, we can present this <code>spicy</code> object as a bubble plot
using the <code><a href="../reference/signifPlot.html">signifPlot()</a></code> function by providing it with the
<code>spicy</code> object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/signifPlot.html">signifPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">spicyTestColPairs</span>,</span>
<span>  marksToPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"alpha"</span>, <span class="st">"acinar"</span>, <span class="st">"ductal"</span>, <span class="st">"naiveTc"</span>, <span class="st">"neutrophil"</span>, <span class="st">"Tc"</span>,</span>
<span>    <span class="st">"Th"</span>, <span class="st">"otherimmune"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="spicyR_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="sessioninfo">sessionInfo()<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] imcRtools_1.10.0            SpatialExperiment_1.14.0   </span></span>
<span><span class="co">#&gt;  [3] SingleCellExperiment_1.26.0 SummarizedExperiment_1.34.0</span></span>
<span><span class="co">#&gt;  [5] Biobase_2.64.0              GenomicRanges_1.56.1       </span></span>
<span><span class="co">#&gt;  [7] GenomeInfoDb_1.40.1         IRanges_2.38.1             </span></span>
<span><span class="co">#&gt;  [9] S4Vectors_0.42.1            BiocGenerics_0.50.0        </span></span>
<span><span class="co">#&gt; [11] MatrixGenerics_1.16.0       matrixStats_1.3.0          </span></span>
<span><span class="co">#&gt; [13] ggplot2_3.5.1               spicyR_1.17.1              </span></span>
<span><span class="co">#&gt; [15] BiocStyle_2.32.1           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] splines_4.4.1               later_1.3.2                </span></span>
<span><span class="co">#&gt;   [3] bitops_1.0-8                svgPanZoom_0.3.4           </span></span>
<span><span class="co">#&gt;   [5] tibble_3.2.1                polyclip_1.10-7            </span></span>
<span><span class="co">#&gt;   [7] lifecycle_1.0.4             sf_1.0-16                  </span></span>
<span><span class="co">#&gt;   [9] rstatix_0.7.2               vroom_1.6.5                </span></span>
<span><span class="co">#&gt;  [11] lattice_0.22-6              MASS_7.3-60.2              </span></span>
<span><span class="co">#&gt;  [13] MultiAssayExperiment_1.30.3 backports_1.5.0            </span></span>
<span><span class="co">#&gt;  [15] magrittr_2.0.3              sass_0.4.9                 </span></span>
<span><span class="co">#&gt;  [17] rmarkdown_2.27              jquerylib_0.1.4            </span></span>
<span><span class="co">#&gt;  [19] yaml_2.3.10                 httpuv_1.6.15              </span></span>
<span><span class="co">#&gt;  [21] ClassifyR_3.8.3             sp_2.1-4                   </span></span>
<span><span class="co">#&gt;  [23] spatstat.sparse_3.1-0       DBI_1.2.3                  </span></span>
<span><span class="co">#&gt;  [25] minqa_1.2.7                 RColorBrewer_1.1-3         </span></span>
<span><span class="co">#&gt;  [27] abind_1.4-5                 zlibbioc_1.50.0            </span></span>
<span><span class="co">#&gt;  [29] purrr_1.0.2                 ggraph_2.2.1               </span></span>
<span><span class="co">#&gt;  [31] RCurl_1.98-1.16             tweenr_2.0.3               </span></span>
<span><span class="co">#&gt;  [33] GenomeInfoDbData_1.2.12     ggrepel_0.9.5              </span></span>
<span><span class="co">#&gt;  [35] RTriangle_1.6-0.13          spatstat.utils_3.0-5       </span></span>
<span><span class="co">#&gt;  [37] terra_1.7-78                pheatmap_1.0.12            </span></span>
<span><span class="co">#&gt;  [39] units_0.8-5                 goftest_1.2-3              </span></span>
<span><span class="co">#&gt;  [41] spatstat.random_3.3-1       DelayedMatrixStats_1.26.0  </span></span>
<span><span class="co">#&gt;  [43] svglite_2.1.3               pkgdown_2.1.0              </span></span>
<span><span class="co">#&gt;  [45] codetools_0.2-20            DelayedArray_0.30.1        </span></span>
<span><span class="co">#&gt;  [47] scuttle_1.14.0              DT_0.33                    </span></span>
<span><span class="co">#&gt;  [49] ggforce_0.4.2               tidyselect_1.2.1           </span></span>
<span><span class="co">#&gt;  [51] raster_3.6-26               UCSC.utils_1.0.0           </span></span>
<span><span class="co">#&gt;  [53] farver_2.1.2                lme4_1.1-35.5              </span></span>
<span><span class="co">#&gt;  [55] viridis_0.6.5               spatstat.explore_3.3-1     </span></span>
<span><span class="co">#&gt;  [57] jsonlite_1.8.8              BiocNeighbors_1.22.0       </span></span>
<span><span class="co">#&gt;  [59] e1071_1.7-14                tidygraph_1.3.1            </span></span>
<span><span class="co">#&gt;  [61] survival_3.6-4              systemfonts_1.1.0          </span></span>
<span><span class="co">#&gt;  [63] tools_4.4.1                 ragg_1.3.2                 </span></span>
<span><span class="co">#&gt;  [65] Rcpp_1.0.13                 glue_1.7.0                 </span></span>
<span><span class="co">#&gt;  [67] gridExtra_2.3               SparseArray_1.4.8          </span></span>
<span><span class="co">#&gt;  [69] xfun_0.46                   mgcv_1.9-1                 </span></span>
<span><span class="co">#&gt;  [71] EBImage_4.46.0              dplyr_1.1.4                </span></span>
<span><span class="co">#&gt;  [73] HDF5Array_1.32.0            scam_1.2-17                </span></span>
<span><span class="co">#&gt;  [75] shinydashboard_0.7.2        withr_3.0.0                </span></span>
<span><span class="co">#&gt;  [77] numDeriv_2016.8-1.1         BiocManager_1.30.23        </span></span>
<span><span class="co">#&gt;  [79] fastmap_1.2.0               boot_1.3-30                </span></span>
<span><span class="co">#&gt;  [81] rhdf5filters_1.16.0         fansi_1.0.6                </span></span>
<span><span class="co">#&gt;  [83] digest_0.6.36               R6_2.5.1                   </span></span>
<span><span class="co">#&gt;  [85] mime_0.12                   textshaping_0.4.0          </span></span>
<span><span class="co">#&gt;  [87] colorspace_2.1-1            tensor_1.5                 </span></span>
<span><span class="co">#&gt;  [89] jpeg_0.1-10                 spatstat.data_3.1-2        </span></span>
<span><span class="co">#&gt;  [91] utf8_1.2.4                  tidyr_1.3.1                </span></span>
<span><span class="co">#&gt;  [93] generics_0.1.3              data.table_1.15.4          </span></span>
<span><span class="co">#&gt;  [95] class_7.3-22                graphlayouts_1.1.1         </span></span>
<span><span class="co">#&gt;  [97] httr_1.4.7                  htmlwidgets_1.6.4          </span></span>
<span><span class="co">#&gt;  [99] S4Arrays_1.4.1              pkgconfig_2.0.3            </span></span>
<span><span class="co">#&gt; [101] gtable_0.3.5                XVector_0.44.0             </span></span>
<span><span class="co">#&gt; [103] htmltools_0.5.8.1           carData_3.0-5              </span></span>
<span><span class="co">#&gt; [105] bookdown_0.40               fftwtools_0.9-11           </span></span>
<span><span class="co">#&gt; [107] scales_1.3.0                ggupset_0.4.0              </span></span>
<span><span class="co">#&gt; [109] png_0.1-8                   spatstat.univar_3.0-0      </span></span>
<span><span class="co">#&gt; [111] knitr_1.48                  tzdb_0.4.0                 </span></span>
<span><span class="co">#&gt; [113] reshape2_1.4.4              rjson_0.2.21               </span></span>
<span><span class="co">#&gt; [115] nlme_3.1-164                nloptr_2.1.1               </span></span>
<span><span class="co">#&gt; [117] proxy_0.4-27                cachem_1.1.0               </span></span>
<span><span class="co">#&gt; [119] rhdf5_2.48.0                stringr_1.5.1              </span></span>
<span><span class="co">#&gt; [121] KernSmooth_2.23-24          vipor_0.4.7                </span></span>
<span><span class="co">#&gt; [123] parallel_4.4.1              concaveman_1.1.0           </span></span>
<span><span class="co">#&gt; [125] desc_1.4.3                  pillar_1.9.0               </span></span>
<span><span class="co">#&gt; [127] grid_4.4.1                  vctrs_0.6.5                </span></span>
<span><span class="co">#&gt; [129] promises_1.3.0              ggpubr_0.6.0               </span></span>
<span><span class="co">#&gt; [131] car_3.1-2                   beachmat_2.20.0            </span></span>
<span><span class="co">#&gt; [133] distances_0.1.10            xtable_1.8-4               </span></span>
<span><span class="co">#&gt; [135] beeswarm_0.4.0              evaluate_0.24.0            </span></span>
<span><span class="co">#&gt; [137] readr_2.1.5                 magick_2.8.4               </span></span>
<span><span class="co">#&gt; [139] cli_3.6.3                   locfit_1.5-9.10            </span></span>
<span><span class="co">#&gt; [141] compiler_4.4.1              rlang_1.1.4                </span></span>
<span><span class="co">#&gt; [143] crayon_1.5.3                ggsignif_0.6.4             </span></span>
<span><span class="co">#&gt; [145] labeling_0.4.3              classInt_0.4-10            </span></span>
<span><span class="co">#&gt; [147] ggbeeswarm_0.7.2            plyr_1.8.9                 </span></span>
<span><span class="co">#&gt; [149] fs_1.6.4                    stringi_1.8.4              </span></span>
<span><span class="co">#&gt; [151] nnls_1.5                    viridisLite_0.4.2          </span></span>
<span><span class="co">#&gt; [153] deldir_2.0-4                BiocParallel_1.38.0        </span></span>
<span><span class="co">#&gt; [155] cytomapper_1.16.0           lmerTest_3.1-3             </span></span>
<span><span class="co">#&gt; [157] munsell_0.5.1               tiff_0.1-12                </span></span>
<span><span class="co">#&gt; [159] spatstat.geom_3.3-2         Matrix_1.7-0               </span></span>
<span><span class="co">#&gt; [161] hms_1.1.3                   bit64_4.0.5                </span></span>
<span><span class="co">#&gt; [163] sparseMatrixStats_1.16.0    Rhdf5lib_1.26.0            </span></span>
<span><span class="co">#&gt; [165] shiny_1.9.0                 highr_0.11                 </span></span>
<span><span class="co">#&gt; [167] igraph_2.0.3                broom_1.0.6                </span></span>
<span><span class="co">#&gt; [169] memoise_2.0.1               bslib_0.8.0                </span></span>
<span><span class="co">#&gt; [171] bit_4.0.5</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicolas Canete, Ellis Patrick.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
